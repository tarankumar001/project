{% extends "base.html" %}

{% block title %}Dashboard - Motor ML{% endblock %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow-sm mb-4 border-0 fade-in-up fade-delay-1">
        <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
          <strong>Training Results</strong>
          <span class="small">
            <a href="{{ url_for('dashboard_upload') }}" class="link-light text-decoration-underline">
              Upload new data
            </a>
          </span>
        </div>
        <div class="card-body">
          {% if results %}
            <div class="row text-center mb-3">
              <div class="col-md-4 mb-2">
                <div class="p-3 bg-light rounded-3 fade-in-up fade-delay-1">
                  <div class="small text-muted">Accuracy</div>
                  <div class="fs-5 fw-semibold">
                    {{ (results.accuracy * 100) | round(2) }}%
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-2">
                <div class="p-3 bg-light rounded-3 fade-in-up fade-delay-2">
                  <div class="small text-muted">Samples</div>
                  <div class="fs-5 fw-semibold">
                    {{ results.n_samples }}
                    <span class="text-muted small d-block">
                      Train {{ results.n_train }}, Test {{ results.n_test }}
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-2">
                <div class="p-3 bg-light rounded-3 fade-in-up fade-delay-3">
                  <div class="small text-muted">ROC AUC</div>
                  <div class="fs-5 fw-semibold">
                    {% if results.roc_auc is not none %}
                      {{ results.roc_auc | round(4) }}
                    {% else %}
                      <span class="text-muted">N/A (multi-class)</span>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            {% if results.class_counts %}
            <div class="mb-3 fade-in-up fade-delay-2">
              <span class="small text-muted">Class distribution:</span>
              {% for label, count in results.class_counts.items() %}
                <span class="badge bg-secondary me-1">
                  {{ label }}: {{ count }}
                </span>
              {% endfor %}
            </div>
            {% endif %}

            <hr class="my-4">

            <div class="row fade-in-up fade-delay-3">
              {% if 'confusion_matrix' in results.plots %}
              <div class="col-md-6 mb-3">
                <h6>Confusion Matrix</h6>
                <img
                  src="{{ url_for('static', filename=results.plots.confusion_matrix) }}?v={{ cache_buster }}"
                  class="img-fluid img-thumbnail graph-animate graph-delay-1"
                  alt="Confusion Matrix"
                >
              </div>
              {% endif %}

              {% if 'roc_curve' in results.plots %}
              <div class="col-md-6 mb-3">
                <h6>ROC Curve</h6>
                <img
                  src="{{ url_for('static', filename=results.plots.roc_curve) }}?v={{ cache_buster }}"
                  class="img-fluid img-thumbnail graph-animate graph-delay-2"
                  alt="ROC Curve"
                >
              </div>
              {% endif %}

              {% if 'feature_importance' in results.plots %}
              <div class="col-md-6 mb-3">
                <h6>Feature Importance</h6>
                <img
                  src="{{ url_for('static', filename=results.plots.feature_importance) }}?v={{ cache_buster }}"
                  class="img-fluid img-thumbnail graph-animate graph-delay-3"
                  alt="Feature Importance"
                >
              </div>
              {% endif %}
            </div>

            <hr class="my-4">

            <div class="mt-3 fade-in-up fade-delay-3">
              <h5>Conclusion</h5>
              {% set anomaly_rate = results.anomaly_rate %}
              {% if anomaly_rate is not none and anomaly_rate > 0.2 and results.accuracy >= 0.8 %}
                <p class="mb-1">
                  <strong class="text-danger">⚠ Motor shows abnormal vibration patterns indicating potential fault.</strong>
                </p>
                <p class="small text-muted mb-0">
                  The model detects a relatively high proportion of anomaly/fault class samples
                  (around {{ (anomaly_rate * 100) | round(1) }}% of the data), and the classification
                  accuracy is strong. This suggests the model is reliably distinguishing between
                  normal and faulty conditions, and the current dataset indicates frequent faults.
                </p>
              {% else %}
                <p class="mb-1">
                  <strong class="text-success">✓ Motor operating within normal conditions.</strong>
                </p>
                <p class="small text-muted mb-0">
                  The anomaly/fault class appears relatively rare in the dataset and the model
                  achieves good accuracy. This suggests the motor behavior captured in the data
                  is mostly normal, and the model can be used as an early warning system for
                  unusual vibration or temperature patterns.
                </p>
              {% endif %}
            </div>
          {% else %}
            <p class="text-muted mb-0">
              No results yet.
              Go to the <strong>Upload</strong> tab and train a model to see metrics here.
            </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

